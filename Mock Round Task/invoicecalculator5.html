<!DOCTYPE html>
<html>
<head>
    <title>Invoice Calculator</title>
</head>
<body>
    <h1>Invoice Calculator</h1>
    
    <div id="input-section">
        <h3>Add Items</h3>
        
        Item Name: <input type="text" id="item-name" placeholder="Enter item name">
        <span id="name-error" style="color: red;"></span>
        <br><br>
        
        Quantity: <input type="number" id="quantity" min="1" placeholder="1">
        <span id="qty-error" style="color: red;"></span>
        <br><br>
        
        Price per Unit: ₹<input type="number" id="price" min="0" placeholder="0.00" step="0.01">
        <span id="price-error" style="color: red;"></span>
        <br><br>
        
        Discount (%): <input type="number" id="discount" min="0" max="100" placeholder="0">
        <span id="discount-error" style="color: red;"></span>
        <br><br>
        
        <button onclick="addItem()">Add Item</button>
        <button onclick="resetInvoice()">Reset Invoice</button>
    </div>
    
    <div id="invoice-section">
        <h3>Invoice</h3>
        <table border="1" style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th>Discount</th>
                    <th>Final Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="invoice-table">
                <tr>
                    <td colspan="7" style="text-align: center;">No items added yet</td>
                </tr>
            </tbody>
        </table>
        
        <div id="total-section" style="margin-top: 20px;">
            <p><strong>Subtotal: ₹<span id="subtotal">0.00</span></strong></p>
            <p><strong>Total Discount: ₹<span id="total-discount">0.00</span></strong></p>
            <p><strong>Tax (18% GST): ₹<span id="tax">0.00</span></strong></p>
            <p><strong>Grand Total: ₹<span id="grand-total">0.00</span></strong></p>
        </div>
        
        <button onclick="saveInvoice()" style="margin-right: 10px;">Save Invoice</button>
        <button onclick="printInvoice()">Print</button>
    </div>

    <script>
        let ii=[], id=1;
        
        const err = ['name-error','qty-error','price-error','discount-error'];
        const clear = () => err.forEach(e=>document.getElementById(e).textContent='');
        
        window.addItem = () => {
            const n=document.getElementById('item-name').value.trim(), q=+document.getElementById('quantity').value, p=+document.getElementById('price').value, d=+document.getElementById('discount').value||0;
            if(!n){document.getElementById('name-error').textContent='Item name required';return;}
            if(!q||q<=0){document.getElementById('qty-error').textContent='Invalid quantity';return;}
            if(!p||p<0){document.getElementById('price-error').textContent='Invalid price';return;}
            if(d<0||d>100){document.getElementById('discount-error').textContent='Invalid discount';return;}
            
            ii.push({id:id++,name:n,qty:q,price:p,disc:d,total:q*p,da:(q*p*d)/100,fa:(q*p)-(q*p*d)/100});
            clear();['item-name','quantity','price','discount'].forEach(f=>document.getElementById(f).value='');
            update();
        };
        
        window.removeItem = rid => {ii=ii.filter(i=>i.id!==rid); update();};
        
        const update = () => {
            const tb=document.getElementById('invoice-table');
            tb.innerHTML = !ii.length?'<tr><td colspan="7" style="text-align:center;">No items yet</td></tr>':ii.map(i=>
                `<tr><td>${i.name}</td><td>${i.qty}</td><td>₹${i.price.toFixed(2)}</td><td>₹${i.total.toFixed(2)}</td><td>${i.disc}% (₹${i.da.toFixed(2)})</td><td>₹${i.fa.toFixed(2)}</td><td><button onclick="removeItem(${i.id})" style="color:red;">Remove</button></td></tr>`
            ).join('');
            
            const st=ii.reduce((s,i)=>s+i.total,0), td=ii.reduce((s,i)=>s+i.da,0), ta=st-td, txx=ta*0.18, gt=ta+txx;
            ['subtotal','total-discount','tax','grand-total'].forEach((f,i)=>document.getElementById(f).textContent=[st,td,txx,gt][i].toFixed(2));
        };
        
        window.resetInvoice = () => {if(confirm('Reset invoice?')){ii=[];id=1;clear();['item-name','quantity','price','discount'].forEach(f=>document.getElementById(f).value='');update();}};
        
        window.saveInvoice = () => {
            if(!ii.length){alert('No items to save');return;}
            const saved=JSON.parse(localStorage.getItem('savedInvoices'))||[];
            saved.push({timestamp:new Date().toLocaleString(),items:ii,totals:{subtotal:+document.getElementById('subtotal').textContent,totalDiscount:+document.getElementById('total-discount').textContent,tax:+document.getElementById('tax').textContent,grandTotal:+document.getElementById('grand-total').textContent}});
            localStorage.setItem('savedInvoices',JSON.stringify(saved));alert('Invoice saved!');
        };
        
        window.printInvoice = () => window.print();
        
        update();
    </script>
</body>
</html>
